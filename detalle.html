<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalles del Caso</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #edf2f7;
      padding: 20px;
      margin: 0;
      animation: fadeIn 0.8s ease-in-out;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 12px 25px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }

    .section {
      margin-bottom: 25px;
    }

    .section-title {
      font-weight: bold;
      font-size: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      color: #555;
    }

    label {
      font-weight: 600;
      margin-top: 12px;
      display: block;
      color: #444;
    }

    input[type="text"], input[type="date"], textarea {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      transition: 0.3s;
      font-size: 14px;
      resize: vertical;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }

    .custom-file-upload {
      display: inline-block;
      padding: 10px 22px;
      background-color: #007bff;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 5px;
      transition: 0.3s;
    }

    .custom-file-upload:hover {
      background-color: #0056b3;
    }

    input[type="file"] {
      display: none;
    }

    iframe {
      width: 100%;
      height: 280px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .denunciado {
      margin-top: 15px;
      border: 1px dashed #aaa;
      padding: 15px;
      border-radius: 12px;
      background: #f9f9f9;
      transition: 0.3s;
    }

    .denunciado:hover {
      background: #f1f5f9;
    }

    .add-btn {
      background-color: #007bff;
      color: white;
      border: none;
      font-size: 22px;
      padding: 5px 12px;
      border-radius: 50%;
      cursor: pointer;
      transition: 0.3s;
    }

    .add-btn:hover {
      background-color: #0056b3;
    }

    .save-btn {
      background-color: #28a745;
      color: white;
      border: none;
      margin-top: 30px;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      width: 100%;
      transition: 0.3s;
    }

    .save-btn:hover {
      background-color: #1e7e34;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }

    @media (max-width: 600px) {
      .container { padding: 20px; }
      .section-title { flex-direction: column; gap: 8px; }
      .add-btn { font-size: 20px; padding: 4px 10px; }
    }
  </style>
</head>
<body>
  <div class="container">    
    <h2>Detalles del Caso Nº <span id="caseNum"></span></h2>

    <!-- Denunciados -->
    <div class="section">
      <div class="section-title">
        <span>Denunciados</span>
        <button class="add-btn" onclick="agregarDenunciado()">+</button>
      </div>
      <div id="denunciados"></div>
    </div>

    <!-- Denunciante y fechas -->
    <div class="section">
      <div class="section-title">Denunciante y Fechas</div>
      <label>Nombre y Apellido</label>
      <input type="text" id="denunciante">

      <label>Fecha de Inicio del Caso</label>
      <input type="date" id="fecha_inicio">

      <label>Fecha de Fin del Caso</label>
      <input type="date" id="fecha_fin">
    </div>

    <!-- Secciones PDF -->
    <div class="section">
      <label>Exposición Inicial (PDF)</label>
      <label for="exposicion" class="custom-file-upload">Seleccionar PDF</label>
      <input type="file" id="exposicion" accept="application/pdf">
      <iframe id="prev_exposicion"></iframe>
    </div>

    <div class="section">
      <label>Consulta ANMAC (PDF)</label>
      <label for="anmac" class="custom-file-upload">Seleccionar PDF</label>
      <input type="file" id="anmac" accept="application/pdf">
      <iframe id="prev_anmac"></iframe>
    </div>

    <div class="section">
      <label>Restricción de Armamento (PDF)</label>
      <label for="restriccion" class="custom-file-upload">Seleccionar PDF</label>
      <input type="file" id="restriccion" accept="application/pdf">
      <iframe id="prev_restriccion"></iframe>
    </div>

    <div class="section">
      <label>Restitución de Armamento (PDF)</label>
      <label for="restitucion" class="custom-file-upload">Seleccionar PDF</label>
      <input type="file" id="restitucion" accept="application/pdf">
      <iframe id="prev_restitucion"></iframe>
    </div>

    <div class="section">
      <label>JUMERE (PDF)</label>
      <label for="jumere" class="custom-file-upload">Seleccionar PDF</label>
      <input type="file" id="jumere" accept="application/pdf">
      <iframe id="prev_jumere"></iframe>
    </div>

    <div class="section">
      <label>Informe Disciplinario Administrativo (PDF)</label>
      <label for="informe" class="custom-file-upload">Seleccionar PDF</label>
      <input type="file" id="informe" accept="application/pdf">
      <iframe id="prev_informe"></iframe>
    </div>

    <!-- Breve reseña para completar -->
    <div class="section">
      <label>Breve Reseña del Caso</label>
      <textarea id="resena" rows="6" placeholder="Escriba aquí una breve reseña del caso..."></textarea>
    </div>

    <button class="save-btn" onclick="guardarDetalles()">Guardar Detalles</button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const num = params.get('caso');
    document.getElementById("caseNum").innerText = num;

    function agregarDenunciado(data = {}) {
      const contenedor = document.getElementById('denunciados');
      const div = document.createElement('div');
      div.className = 'denunciado';
      div.innerHTML = `
        <label>Nombre y Apellido</label>
        <input type="text" value="${data.nombre || ''}">
        <label>MI</label>
        <input type="text" value="${data.mi || ''}">
        <label>CE</label>
        <input type="text" value="${data.ce || ''}">
        <label>Grado</label>
        <input type="text" value="${data.grado || ''}">
        <label>Situación de Revista</label>
        <input type="text" value="${data.situacion || ''}">
        <label>Unidad de Revista</label>
        <input type="text" value="${data.unidad || ''}">
      `;
      contenedor.appendChild(div);
    }

    function cargarArchivo(inputId, prevId) {
      document.getElementById(inputId).addEventListener('change', function(e){
        const file = e.target.files[0];
        if(file){
          const reader = new FileReader();
          reader.onload = function(ev){
            document.getElementById(prevId).src = ev.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    }

    ["exposicion","anmac","restriccion","restitucion","jumere","informe"].forEach(id => {
      cargarArchivo(id, "prev_" + id);
    });

    function guardarDetalles() {
      const denunciante = document.getElementById('denunciante').value;
      const fecha_inicio = document.getElementById('fecha_inicio').value;
      const fecha_fin = document.getElementById('fecha_fin').value;
      const denunciados = [];
      document.querySelectorAll('.denunciado').forEach(div => {
        const inputs = div.querySelectorAll('input');
        denunciados.push({
          nombre: inputs[0].value,
          mi: inputs[1].value,
          ce: inputs[2].value,
          grado: inputs[3].value,
          situacion: inputs[4].value,
          unidad: inputs[5].value
        });
      });
      const pdfs = {};
      ["exposicion","anmac","restriccion","restitucion","jumere","informe"].forEach(id => {
        pdfs[id] = document.getElementById("prev_" + id).src || "";
      });
      const resena_texto = document.getElementById('resena').value;
      const data = { denunciante, fecha_inicio, fecha_fin, denunciados, ...pdfs, resena_texto };
      localStorage.setItem(`detalle-${num}`, JSON.stringify(data));
      alert("Detalles guardados correctamente.");
    }

    window.onload = function() {
      const detalle = JSON.parse(localStorage.getItem(`detalle-${num}`));
      if (detalle) {
        document.getElementById('denunciante').value = detalle.denunciante || "";
        document.getElementById('fecha_inicio').value = detalle.fecha_inicio || "";
        document.getElementById('fecha_fin').value = detalle.fecha_fin || "";
        if (detalle.denunciados && detalle.denunciados.length > 0) {
          detalle.denunciados.forEach(d => agregarDenunciado(d));
        } else {
          agregarDenunciado();
        }
        ["exposicion","anmac","restriccion","restitucion","jumere","informe"].forEach(id => {
          if(detalle[id]) document.getElementById("prev_" + id).src = detalle[id];
        });
        if(detalle.resena_texto) document.getElementById("resena").value = detalle.resena_texto;
      } else {
        agregarDenunciado();
      }
    };
  </script>
</body>
</html>

